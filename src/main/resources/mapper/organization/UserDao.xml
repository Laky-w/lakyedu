<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.laky.edu.organization.dao.UserDao">

    <resultMap id="BaseResultMap" type="com.laky.edu.organization.bean.User">
        <id column="id" jdbcType="INTEGER" property="id" />
        <result column="user_name" jdbcType="INTEGER" property="userName" />
        <result column="nickname" jdbcType="INTEGER" property="nickName" />
        <result column="name" jdbcType="INTEGER" property="name" />
        <result column="password" jdbcType="VARCHAR" property="password" />
        <result column="head_logo" jdbcType="TINYINT" property="headLogo" />
        <result column="phone" jdbcType="VARCHAR" property="phone" />
        <result column="email" jdbcType="VARCHAR" property="email" />
        <result column="id_card" jdbcType="VARCHAR" property="idCard" />
        <result column="the_status" jdbcType="TIMESTAMP" property="theStatus" />
        <result column="branch_id" jdbcType="INTEGER" property="branchId" />
        <result column="school_zone_id" jdbcType="INTEGER" property="schoolZoneId" />
        <result column="sex" jdbcType="INTEGER" property="sex" />
        <result column="is_super" jdbcType="INTEGER" property="isSuper" />
        <result column="birthday" jdbcType="INTEGER" property="birthday" />
        <result column="birthday" jdbcType="TIMESTAMP" property="birthday" />
        <result column="create_datetime" jdbcType="TIMESTAMP" property="createDatetime" />
        <association property="schoolZone" column="school_zone_id" javaType="com.laky.edu.organization.bean.SchoolZone" resultMap="SchoolZoneMap" />
        <association property="branch" column="branch_id" javaType="com.laky.edu.organization.bean.Branch" resultMap="BranchMap" />
    </resultMap>
    <resultMap id="SchoolZoneMap" type="com.laky.edu.organization.bean.SchoolZone">
        <id property="id" column="id" />
        <result property="name" column="sz_name" />
    </resultMap>
    <resultMap id="BranchMap" type="com.laky.edu.organization.bean.Branch">
        <id property="id" column="id" />
        <result property="branchName" column="branch_name" />
    </resultMap>
    <insert id="insertUser" keyColumn="id" keyProperty="id" useGeneratedKeys="true" parameterType="com.laky.edu.organization.bean.User">
      INSERT  INTO  laky_organization_user(user_name,nick_name,`name`,`password`,head_logo,the_status,branch_id,school_zone_id,
      create_datetime,phone,email,sex,birthday,is_super,id_card)
      VALUES (#{userName},#{nickName},#{name},#{password},#{headLogo},
      #{theStatus},#{branchId},#{schoolZoneId},#{createDatetime},#{phone},
      #{email},#{sex},#{birthday},#{isSuper},#{idCard})
    </insert>
    <select id="queryUserByUserName"   resultMap="BaseResultMap">
      SELECT  u.*,sz.`name` as sz_name,b.branch_name  FROM laky_organization_user u LEFT JOIN  laky_organization_branch b on u.branch_id = b.id and b.the_status =1 LEFT JOIN  laky_organization_school_zone sz on sz.id =u.school_zone_id and sz.the_status !=0
      WHERE (u.user_name = #{userName} or u.email = #{userName} or u.phone = #{userName}) and u.the_status != 0 and b.serial = #{serial} and b.the_status =1

    </select>
    <select id="queryUserBySchoolId"   resultType="com.laky.edu.organization.bean.User" resultMap="BaseResultMap">
       SELECT s.*,sz.`name` as sz_name  from laky_organization_user s
       LEFT JOIN laky_organization_school_zone sz on sz.id =s.school_zone_id and sz.the_status !=0 where s.the_status !=0
        <if test="userName != null">
            AND s.`user_name` LIKE CONCAT('%',#{userName,jdbcType=VARCHAR},'%')
        </if>
        <if test="schoolZoneId != null">
            AND s.school_zone_id IN
            <foreach collection="schoolZoneId" item="schoolId" index="index"
                     open="(" close=")" separator=",">
                #{schoolId}
            </foreach>
        </if>
        <if test="schoolZoneId2 != null">
            <if test="schoolZoneId2 instanceof String">
            AND s.school_zone_id = #{schoolZoneId2,jdbcType=INTEGER}
        </if>
            <if test="!(schoolZoneId2 instanceof String)">
                AND s.school_zone_id IN
                <foreach collection="schoolZoneId2" item="schoolId" index="index"
                         open="(" close=")" separator=",">
                    #{schoolId}
                </foreach>
            </if>
        </if>
    </select>
    <!--<resultMap type="com.laky.edu.organization.bean.User" id="userResultMap">

        <association property="branch" javaType="com.laky.edu.organization.bean.Branch">
            <id column="branch_id" property="id"/>
            <result column="username" property="username"/>
            <result column="sex" property="sex"/>
            <result column="address" property="address"/>
        </association>

        property表示返回类型Clazz的属性students
            column表示将id作为参数进行之后的查询
            fetchtype表示懒加载
            javaType表示属性对应的类型
            ofType表示集合当中的类型

        <collection property="branch.id" column="branch_id" fetchType="lazy"
                    javaType="com.laky.edu.organization.bean.Branch"
                    select="com.laky.edu.organization.dao.BranchDao.queryBranchBySerialOrId">
            <id property="id" column="id"/>
            <result property="name" column="name"/>
            <result property="sex" column="sex"/>
            <result property="age" column="age"/>
        </collection>
    </resultMap>-->
</mapper>